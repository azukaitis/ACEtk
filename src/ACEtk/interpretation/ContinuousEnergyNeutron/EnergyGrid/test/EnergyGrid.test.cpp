#define CATCH_CONFIG_MAIN

#include "catch.hpp"
#include "ACEtk.hpp"

using namespace njoy::ACEtk;

std::vector<double> refEnergies{{
  1.00000000000E-11 , 1.03125000000E-11 , 1.06250000000E-11 , 1.09375000000E-11,
  1.12500000000E-11 , 1.15625000000E-11 , 1.18750000000E-11 , 1.21875000000E-11,
  1.25000000000E-11 , 1.28125000000E-11 , 1.31250000000E-11 , 1.34375000000E-11,
  1.37500000000E-11 , 1.43750000000E-11 , 1.50000000000E-11 , 1.56250000000E-11,
  1.62500000000E-11 , 1.68750000000E-11 , 1.75000000000E-11 , 1.81250000000E-11,
  1.87500000000E-11 , 1.93750000000E-11 , 2.00000000000E-11 , 2.09375000000E-11,
  2.18750000000E-11 , 2.28125000000E-11 , 2.37500000000E-11 , 2.46875000000E-11,
  2.56250000000E-11 , 2.65625000000E-11 , 2.75000000000E-11 , 2.84375000000E-11,
  2.93750000000E-11 , 3.03125000000E-11 , 3.12500000000E-11 , 3.21875000000E-11,
  3.31250000000E-11 , 3.40625000000E-11 , 3.50000000000E-11 , 3.59375000000E-11,
  3.68750000000E-11 , 3.78125000000E-11 , 3.87500000000E-11 , 3.96875000000E-11,
  4.06250000000E-11 , 4.25000000000E-11 , 4.43750000000E-11 , 4.62500000000E-11,
  4.81250000000E-11 , 5.00000000000E-11 , 5.15625000000E-11 , 5.31250000000E-11,
  5.46875000000E-11 , 5.62500000000E-11 , 5.78125000000E-11 , 5.93750000000E-11,
  6.09375000000E-11 , 6.25000000000E-11 , 6.40625000000E-11 , 6.56250000000E-11,
  6.71875000000E-11 , 6.87500000000E-11 , 7.18750000000E-11 , 7.50000000000E-11,
  7.81250000000E-11 , 8.12500000000E-11 , 8.43750000000E-11 , 8.75000000000E-11,
  9.06250000000E-11 , 9.37500000000E-11 , 9.68750000000E-11 , 1.00000000000E-10,
  1.03125000000E-10 , 1.06250000000E-10 , 1.09375000000E-10 , 1.12500000000E-10,
  1.15625000000E-10 , 1.18750000000E-10 , 1.21875000000E-10 , 1.25000000000E-10,
  1.28125000000E-10 , 1.31250000000E-10 , 1.34375000000E-10 , 1.37500000000E-10,
  1.43750000000E-10 , 1.50000000000E-10 , 1.56250000000E-10 , 1.62500000000E-10,
  1.68750000000E-10 , 1.75000000000E-10 , 1.81250000000E-10 , 1.87500000000E-10,
  1.93750000000E-10 , 2.00000000000E-10 , 2.09375000000E-10 , 2.18750000000E-10,
  2.28125000000E-10 , 2.37500000000E-10 , 2.46875000000E-10 , 2.56250000000E-10,
  2.65625000000E-10 , 2.75000000000E-10 , 2.84375000000E-10 , 2.93750000000E-10,
  3.03125000000E-10 , 3.12500000000E-10 , 3.21875000000E-10 , 3.31250000000E-10,
  3.40625000000E-10 , 3.50000000000E-10 , 3.59375000000E-10 , 3.68750000000E-10,
  3.78125000000E-10 , 3.87500000000E-10 , 3.96875000000E-10 , 4.06250000000E-10,
  4.25000000000E-10 , 4.43750000000E-10 , 4.62500000000E-10 , 4.81250000000E-10,
  5.00000000000E-10 , 5.15625000000E-10 , 5.31250000000E-10 , 5.46875000000E-10,
  5.62500000000E-10 , 5.78125000000E-10 , 5.93750000000E-10 , 6.09375000000E-10,
  6.25000000000E-10 , 6.40625000000E-10 , 6.56250000000E-10 , 6.71875000000E-10,
  6.87500000000E-10 , 7.18750000000E-10 , 7.50000000000E-10 , 7.81250000000E-10,
  8.12500000000E-10 , 8.43750000000E-10 , 8.75000000000E-10 , 9.06250000000E-10,
  9.37500000000E-10 , 9.68750000000E-10 , 1.00000000000E-09 , 1.03125000000E-09,
  1.06250000000E-09 , 1.09375000000E-09 , 1.12500000000E-09 , 1.15625000000E-09,
  1.18750000000E-09 , 1.21875000000E-09 , 1.25000000000E-09 , 1.28125000000E-09,
  1.31250000000E-09 , 1.34375000000E-09 , 1.37500000000E-09 , 1.43750000000E-09,
  1.50000000000E-09 , 1.56250000000E-09 , 1.62500000000E-09 , 1.68750000000E-09,
  1.75000000000E-09 , 1.81250000000E-09 , 1.87500000000E-09 , 1.93750000000E-09,
  2.00000000000E-09 , 2.09375000000E-09 , 2.18750000000E-09 , 2.28125000000E-09,
  2.37500000000E-09 , 2.46875000000E-09 , 2.56250000000E-09 , 2.65625000000E-09,
  2.75000000000E-09 , 2.84375000000E-09 , 2.93750000000E-09 , 3.03125000000E-09,
  3.12500000000E-09 , 3.21875000000E-09 , 3.31250000000E-09 , 3.40625000000E-09,
  3.50000000000E-09 , 3.59375000000E-09 , 3.68750000000E-09 , 3.78125000000E-09,
  3.87500000000E-09 , 3.96875000000E-09 , 4.06250000000E-09 , 4.25000000000E-09,
  4.43750000000E-09 , 4.62500000000E-09 , 4.81250000000E-09 , 5.00000000000E-09,
  5.15625000000E-09 , 5.31250000000E-09 , 5.46875000000E-09 , 5.62500000000E-09,
  5.78125000000E-09 , 5.93750000000E-09 , 6.09375000000E-09 , 6.25000000000E-09,
  6.40625000000E-09 , 6.56250000000E-09 , 6.71875000000E-09 , 6.87500000000E-09,
  7.18750000000E-09 , 7.50000000000E-09 , 7.81250000000E-09 , 8.12500000000E-09,
  8.43750000000E-09 , 8.75000000000E-09 , 9.06250000000E-09 , 9.37500000000E-09,
  9.68750000000E-09 , 1.00000000000E-08 , 1.03125000000E-08 , 1.06250000000E-08,
  1.09375000000E-08 , 1.12500000000E-08 , 1.15625000000E-08 , 1.18750000000E-08,
  1.21875000000E-08 , 1.25000000000E-08 , 1.28125000000E-08 , 1.31250000000E-08,
  1.34375000000E-08 , 1.37500000000E-08 , 1.43750000000E-08 , 1.50000000000E-08,
  1.56250000000E-08 , 1.62500000000E-08 , 1.68750000000E-08 , 1.75000000000E-08,
  1.81250000000E-08 , 1.87500000000E-08 , 1.93750000000E-08 , 2.00000000000E-08,
  2.06625000000E-08 , 2.13250000000E-08 , 2.19875000000E-08 , 2.26500000000E-08,
  2.33125000000E-08 , 2.39750000000E-08 , 2.46375000000E-08 , 2.53000000000E-08,
  2.64578200000E-08 , 2.76156300000E-08 , 2.87734400000E-08 , 2.99312500000E-08,
  3.10890700000E-08 , 3.22468800000E-08 , 3.34046900000E-08 , 3.45625000000E-08,
  3.55273500000E-08 , 3.64921900000E-08 , 3.74570400000E-08 , 3.84218800000E-08,
  3.93867300000E-08 , 4.03515700000E-08 , 4.13164100000E-08 , 4.22812500000E-08,
  4.42109400000E-08 , 4.61406300000E-08 , 4.80703200000E-08 , 5.00000000000E-08,
  5.15625000000E-08 , 5.31250000000E-08 , 5.46875000000E-08 , 5.62500000000E-08,
  5.78125000000E-08 , 5.93750000000E-08 , 6.09375000000E-08 , 6.25000000000E-08,
  6.40625000000E-08 , 6.56250000000E-08 , 6.71875000000E-08 , 6.87500000000E-08,
  7.18750000000E-08 , 7.50000000000E-08 , 7.81250000000E-08 , 8.12500000000E-08,
  8.43750000000E-08 , 8.75000000000E-08 , 9.06250000000E-08 , 9.37500000000E-08,
  9.68750000000E-08 , 1.00000000000E-07 , 1.03125000000E-07 , 1.06250000000E-07,
  1.09375000000E-07 , 1.12500000000E-07 , 1.15625000000E-07 , 1.18750000000E-07,
  1.21875000000E-07 , 1.25000000000E-07 , 1.28125000000E-07 , 1.31250000000E-07,
  1.34375000000E-07 , 1.37500000000E-07 , 1.43750000000E-07 , 1.50000000000E-07,
  1.56250000000E-07 , 1.62500000000E-07 , 1.68750000000E-07 , 1.75000000000E-07,
  1.81250000000E-07 , 1.87500000000E-07 , 1.93750000000E-07 , 2.00000000000E-07,
  2.09375000000E-07 , 2.18750000000E-07 , 2.28125000000E-07 , 2.37500000000E-07,
  2.46875000000E-07 , 2.56250000000E-07 , 2.65625000000E-07 , 2.75000000000E-07,
  2.84375000000E-07 , 2.93750000000E-07 , 3.03125000000E-07 , 3.12500000000E-07,
  3.21875000000E-07 , 3.31250000000E-07 , 3.40625000000E-07 , 3.50000000000E-07,
  3.59375000000E-07 , 3.68750000000E-07 , 3.78125000000E-07 , 3.87500000000E-07,
  3.96875000000E-07 , 4.06250000000E-07 , 4.25000000000E-07 , 4.43750000000E-07,
  4.62500000000E-07 , 5.00000000000E-07 , 5.31250000000E-07 , 5.62500000000E-07,
  5.93750000000E-07 , 6.25000000000E-07 , 6.87500000000E-07 , 7.50000000000E-07,
  8.12500000000E-07 , 8.75000000000E-07 , 9.37500000000E-07 , 1.00000000000E-06,
  1.06250000000E-06 , 1.12500000000E-06 , 1.18750000000E-06 , 1.25000000000E-06,
  1.37500000000E-06 , 1.50000000000E-06 , 1.62500000000E-06 , 1.75000000000E-06,
  1.87500000000E-06 , 2.00000000000E-06 , 2.18750000000E-06 , 2.37500000000E-06,
  2.56250000000E-06 , 2.75000000000E-06 , 2.93750000000E-06 , 3.12500000000E-06,
  3.31250000000E-06 , 3.50000000000E-06 , 3.87500000000E-06 , 4.25000000000E-06,
  4.62500000000E-06 , 5.00000000000E-06 , 5.31250000000E-06 , 5.62500000000E-06,
  5.93750000000E-06 , 6.25000000000E-06 , 6.87500000000E-06 , 7.50000000000E-06,
  8.12500000000E-06 , 8.75000000000E-06 , 9.37500000000E-06 , 1.00000000000E-05,
  1.06250000000E-05 , 1.12500000000E-05 , 1.18750000000E-05 , 1.25000000000E-05,
  1.37500000000E-05 , 1.50000000000E-05 , 1.62500000000E-05 , 1.75000000000E-05,
  1.87500000000E-05 , 2.00000000000E-05 , 2.18750000000E-05 , 2.37500000000E-05,
  2.56250000000E-05 , 2.75000000000E-05 , 2.93750000000E-05 , 3.12500000000E-05,
  3.31250000000E-05 , 3.50000000000E-05 , 3.87500000000E-05 , 4.25000000000E-05,
  4.62500000000E-05 , 5.00000000000E-05 , 5.31250000000E-05 , 5.62500000000E-05,
  5.93750000000E-05 , 6.25000000000E-05 , 6.87500000000E-05 , 7.50000000000E-05,
  8.12500000000E-05 , 8.75000000000E-05 , 9.37500000000E-05 , 1.00000000000E-04,
  1.06250000000E-04 , 1.12500000000E-04 , 1.18750000000E-04 , 1.25000000000E-04,
  1.37500000000E-04 , 1.50000000000E-04 , 1.62500000000E-04 , 1.75000000000E-04,
  1.87500000000E-04 , 2.00000000000E-04 , 2.18750000000E-04 , 2.37500000000E-04,
  2.56250000000E-04 , 2.75000000000E-04 , 2.93750000000E-04 , 3.12500000000E-04,
  3.31250000000E-04 , 3.50000000000E-04 , 3.87500000000E-04 , 4.25000000000E-04,
  4.62500000000E-04 , 5.00000000000E-04 , 5.31250000000E-04 , 5.62500000000E-04,
  5.93750000000E-04 , 6.25000000000E-04 , 6.87500000000E-04 , 7.50000000000E-04,
  8.12500000000E-04 , 8.75000000000E-04 , 9.37500000000E-04 , 1.00000000000E-03,
  1.06250000000E-03 , 1.12500000000E-03 , 1.18750000000E-03 , 1.25000000000E-03,
  1.37500000000E-03 , 1.50000000000E-03 , 1.62500000000E-03 , 1.75000000000E-03,
  1.87500000000E-03 , 2.00000000000E-03 , 2.12500000000E-03 , 2.25000000000E-03,
  2.37500000000E-03 , 2.50000000000E-03 , 2.75000000000E-03 , 3.00000000000E-03,
  3.25000000000E-03 , 3.50000000000E-03 , 3.75000000000E-03 , 4.00000000000E-03,
  4.25000000000E-03 , 4.50000000000E-03 , 4.75000000000E-03 , 5.00000000000E-03,
  5.25000000000E-03 , 5.50000000000E-03 , 5.75000000000E-03 , 6.00000000000E-03,
  6.25000000000E-03 , 6.50000000000E-03 , 6.75000000000E-03 , 7.00000000000E-03,
  7.50000000000E-03 , 8.00000000000E-03 , 8.50000000000E-03 , 9.00000000000E-03,
  9.50000000000E-03 , 1.00000000000E-02 , 1.12500000000E-02 , 1.25000000000E-02,
  1.50000000000E-02 , 1.75000000000E-02 , 2.00000000000E-02 , 2.25000000000E-02,
  2.50000000000E-02 , 2.75000000000E-02 , 3.00000000000E-02 , 3.25000000000E-02,
  3.50000000000E-02 , 3.75000000000E-02 , 4.00000000000E-02 , 4.25000000000E-02,
  4.50000000000E-02 , 4.75000000000E-02 , 5.00000000000E-02 , 5.25000000000E-02,
  5.50000000000E-02 , 5.75000000000E-02 , 6.00000000000E-02 , 6.25000000000E-02,
  6.50000000000E-02 , 6.75000000000E-02 , 7.00000000000E-02 , 7.50000000000E-02,
  8.00000000000E-02 , 8.50000000000E-02 , 9.00000000000E-02 , 9.50000000000E-02,
  1.00000000000E-01 , 1.12500000000E-01 , 1.25000000000E-01 , 1.50000000000E-01,
  1.75000000000E-01 , 2.00000000000E-01 , 2.25000000000E-01 , 2.50000000000E-01,
  2.75000000000E-01 , 3.00000000000E-01 , 3.25000000000E-01 , 3.50000000000E-01,
  3.75000000000E-01 , 4.00000000000E-01 , 4.25000000000E-01 , 4.50000000000E-01,
  4.75000000000E-01 , 5.00000000000E-01 , 5.25000000000E-01 , 5.50000000000E-01,
  5.75000000000E-01 , 6.00000000000E-01 , 6.25000000000E-01 , 6.50000000000E-01,
  6.75000000000E-01 , 7.00000000000E-01 , 7.50000000000E-01 , 8.00000000000E-01,
  8.50000000000E-01 , 9.00000000000E-01 , 9.50000000000E-01 , 1.00000000000E+00,
  1.20000000000E+00 , 1.40000000000E+00 , 1.60000000000E+00 , 1.80000000000E+00,
  2.00000000000E+00 , 2.20000000000E+00 , 2.40000000000E+00 , 2.60000000000E+00,
  2.80000000000E+00 , 3.00000000000E+00 , 3.20000000000E+00 , 3.40000000000E+00,
  3.60000000000E+00 , 3.80000000000E+00 , 4.00000000000E+00 , 4.20000000000E+00,
  4.40000000000E+00 , 4.60000000000E+00 , 4.80000000000E+00 , 5.00000000000E+00,
  5.50000000000E+00 , 6.00000000000E+00 , 6.50000000000E+00 , 7.00000000000E+00,
  7.50000000000E+00 , 8.00000000000E+00 , 8.50000000000E+00 , 9.00000000000E+00,
  9.50000000000E+00 , 1.00000000000E+01 , 1.05000000000E+01 , 1.10000000000E+01,
  1.15000000000E+01 , 1.20000000000E+01 , 1.25000000000E+01 , 1.30000000000E+01,
  1.35000000000E+01 , 1.40000000000E+01 , 1.45000000000E+01 , 1.50000000000E+01,
  1.55000000000E+01 , 1.60000000000E+01 , 1.65000000000E+01 , 1.70000000000E+01,
  1.75000000000E+01 , 1.80000000000E+01 , 1.85000000000E+01 , 1.90000000000E+01,
  1.95000000000E+01 , 2.00000000000E+01,
}};

SCENARIO( "Testing the EnergyGrid" ){
  GIVEN( "An ACE Table for 1001.710nc" ){
    auto ACETable = Table( njoy::utility::slurpFileToMemory("1001.710nc") );

    WHEN( "extracting the EnergyGrid" ){
      auto energyGrid = interpretation::nc::EnergyGrid( ACETable );
      
      THEN( "parameters can be extracted and verified" ){
        REQUIRE( 590 == energyGrid.size() );
        for( const auto pair : 
             ranges::view::zip( refEnergies, energyGrid.energies() ) ){

             REQUIRE( pair.first == Approx( pair.second ) );
        }

        std::vector<double> refSlice = {{1.03125E-11, 1.0625E-11, 1.0937E-11}};
        auto gridSlice = energyGrid.energies(2,3);
        REQUIRE( refSlice[0] == Approx( gridSlice[0] ) );
        REQUIRE( refSlice[1] == Approx( gridSlice[1] ) );
        REQUIRE( refSlice[2] == Approx( gridSlice[2] ) );
      } // THEN
    } // WHEN
  } // GIVEN
} // SCENARIO

